{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_thread-loader@2.1.3@thread-loader\\dist\\cjs.js!C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_babel-loader@8.2.4@babel-loader\\lib\\index.js!C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_vue-loader@15.9.8@vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\src\\views\\category\\Category.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\src\\views\\category\\Category.vue","mtime":1649234414681},{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\babel.config.js","mtime":1648446710422},{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_thread-loader@2.1.3@thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_babel-loader@8.2.4@babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_vue-loader@15.9.8@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"C:/Users/Administrator/Desktop/SuperMarket/supermarket/node_modules/_@babel_runtime@7.17.8@@babel/runtime/helpers/esm/defineProperty.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport CategoryMenu from \"./CategoryMenu\";\nimport CategoryContent from \"./CategoryContent\";\nimport NavBar from \"../../components/common/navbar/NavBar\";\nimport BackTop from \"../../components/content/backTop/BackTop\";\nimport TabControl from \"../../components/content/tabControl\";\nimport Scroll from \"../../components/common/scroll/Scroll\";\nimport GoodsList from \"../../components/content/goods/goodsList\";\nimport { POP, NEW, SELL, TOP_DISTANCE } from \"../../common/const\";\nimport { getCategory, getSubcategory, getCategoryDetail } from \"../../network/category\";\nimport { itemListener, backTopMinxin, tabControlMixin } from \"../../common/mixin\";\nexport default {\n  name: \"Category\",\n  components: {\n    CategoryMenu: CategoryMenu,\n    NavBar: NavBar,\n    CategoryContent: CategoryContent,\n    TabControl: TabControl,\n    BackTop: BackTop,\n    Scroll: Scroll,\n    GoodsList: GoodsList\n  },\n  mixins: [itemListener, backTopMinxin, tabControlMixin],\n  data: function data() {\n    return {\n      categories: [],\n      categoryData: {},\n      scroll: null,\n      isTabFixed: false,\n      currentIndex: -1,\n      currentType: POP,\n      saveY: 0,\n      tabOffsetTop: 0\n    };\n  },\n  computed: {\n    showSubcategory: function showSubcategory() {\n      if (this.currentIndex === -1) {\n        return {};\n      }\n\n      return this.categoryData[this.currentIndex].subcategories;\n    } // showCategoryDetail() {\n    //   if(this.currentIndex === -1) {\n    //     return [];\n    //   }\n    //   return this.categoryDetail[this.currentIndex].categoryDetail[this.currentType];\n    // }\n\n  },\n  created: function created() {\n    //请求分类数据\n    this._getCategory();\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    this.$bus.$on('gridViewImgLoad', function () {\n      //refresh重新计算better-scroll,   this.$refs.scroll：组件创建完成才能执行后面函数\n      _this.$refs.scroll.scroll.refresh();\n\n      _this.tabOffsetTop = _this.$refs.tabControl2.$el.offsetTop;\n      _this.tabOffsetLeft = _this.$refs.scroll.$el.offsetLeft;\n    });\n  },\n  activated: function activated() {\n    //一进入组件就滚动到离开时保存的位置\n    this.$refs.scroll && this.$refs.scroll.scrollTo(0, this.saveY, 10); //refresh\n\n    this.$refs.scroll && this.$refs.scroll.scroll.refresh();\n  },\n  deactivated: function deactivated() {\n    //保存离开时的位置\n    this.saveY = this.$refs.scroll.scroll.y; // 2、取消全局事件监听\n\n    this.$bus.$off('itemImgLoad', this.itemImgListener);\n  },\n  methods: {\n    /**\n     * 事件相应相关方法\n     */\n    //tabControl的点击，mixin里的tabClick发生点击事件并调用此方法\n    _tabClick: function _tabClick(index) {\n      this.$refs.tabControl1.currentIndex = index;\n      this.$refs.tabControl2.currentIndex = index;\n    },\n    //监听点击了那个分类栏目\n    selectItem: function selectItem(index) {\n      this._getSubCategories(index);\n\n      console.log(index);\n    },\n    //监听滚动的位置（使用scroll组件传过来的事件）\n    contentScroll: function contentScroll(position) {\n      //监听BackTop是否显示\n      this.isShowBackTop = position.y < TOP_DISTANCE; //判断tabControl是否需要吸顶\n\n      this.isTabFixed = this.tabOffsetTop <= -position.y;\n    },\n\n    /**\n     * 网络请求额相关法\n     */\n    //1、拿到分类数据\n    _getCategory: function _getCategory() {\n      var _this2 = this;\n\n      getCategory().then(function (res) {\n        console.log(res.data); //保存分类数据\n\n        _this2.categories = res.data.category.list; // console.log(this.categories);\n        //初始化每个类别的子数据\n\n        for (var i = 0; i < _this2.categories.length; i++) {\n          _this2.categoryData[i] = {\n            subcategories: {},\n            categoryDetail: {\n              'pop': [],\n              'new': [],\n              'sell': []\n            }\n          };\n        } //请求第一个分类的数据\n\n\n        _this2._getSubCategories(0);\n      });\n    },\n    //根据分类栏的下标去请求相应的数据\n    _getSubCategories: function _getSubCategories(index) {\n      var _this3 = this;\n\n      this.currentIndex = index;\n      var mailKey = this.categories[index].maitKey; // console.log(mailKey);\n\n      getSubcategory(mailKey).then(function (res) {\n        console.log(res.data);\n        _this3.categoryData[index].subcategories = res.data;\n        _this3.categoryData = _objectSpread({}, _this3.categoryData); // this._getCategoryDetail(POP)\n        // this._getCategoryDetail(SELL)\n        // this._getCategoryDetail(NEW)\n      });\n    },\n    //3、根据类型请求相应的商品数据（pop,new,sell）\n    _getCategoryDetail: function _getCategoryDetail(type) {\n      var _this4 = this;\n\n      //获取请求的minWallkey\n      var miniWallkey = this.categories[this.currentIndex].miniWallkey; //发送请求,传入miniWallkey和type\n\n      getCategoryDetail(miniWallkey, type).then(function (res) {\n        //将获取的数据保存下来\n        _this4.categoryData[_this4.currentIndex].categoryDetail[type] = res;\n        _this4.categoryData = _objectSpread({}, _this4.categoryData);\n      });\n    }\n  }\n};",{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8CA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACAA,kBADA;AAEAC;AACAC,8BADA;AAEAC,kBAFA;AAGAC,oCAHA;AAIAC,0BAJA;AAKAC,oBALA;AAMAC,kBANA;AAOAC;AAPA,GAFA;AAWAC,wDAXA;AAYAC,MAZA,kBAYA;AACA;AACAC,oBADA;AAEAC,sBAFA;AAGAC,kBAHA;AAIAC,uBAJA;AAKAC,sBALA;AAMAC,sBANA;AAOAC,cAPA;AAQAC;AARA;AAUA,GAvBA;AAwBAC;AAEAC,mBAFA,6BAEA;AACA;AACA;AACA;;AACA;AACA,KAPA,CAQA;AACA;AACA;AACA;AACA;AACA;;AAbA,GAxBA;AAuCAC,SAvCA,qBAuCA;AACA;AACA;AAEA,GA3CA;AA4CAC,SA5CA,qBA4CA;AAAA;;AACA;AACA;AACA;;AACA;AACA;AACA,KALA;AAMA,GAnDA;AAoDAC,WApDA,uBAoDA;AACA;AACA,uEAFA,CAGA;;AACA;AACA,GAzDA;AA0DAC,aA1DA,yBA0DA;AACA;AACA,4CAFA,CAIA;;AACA;AAEA,GAjEA;AAkEAC;AACA;AACA;AACA;AACA;AACAC,aALA,qBAKAC,KALA,EAKA;AACA;AACA;AACA,KARA;AASA;AACAC,cAVA,sBAUAD,KAVA,EAUA;AACA;;AACAE;AACA,KAbA;AAcA;AACAC,iBAfA,yBAeAC,QAfA,EAeA;AACA;AACA,qDAFA,CAIA;;AACA;AACA,KArBA;;AAsBA;AACA;AACA;AACA;AACAC,gBA1BA,0BA0BA;AAAA;;AACAC;AACAJ,8BADA,CAEA;;AACA,mDAHA,CAIA;AACA;;AACA;AACA;AACAK,6BADA;AAEAC;AACA,uBADA;AAEA,uBAFA;AAGA;AAHA;AAFA;AAQA,SAfA,CAgBA;;;AACA;AACA,OAlBA;AAmBA,KA9CA;AA+CA;AACAC,qBAhDA,6BAgDAT,KAhDA,EAgDA;AAAA;;AACA;AACA,mDAFA,CAGA;;AACAU;AACAR;AACA;AAEA,qEAJA,CAKA;AACA;AACA;AACA,OARA;AASA,KA7DA;AA8DA;AACAS,sBA/DA,8BA+DAC,IA/DA,EA+DA;AAAA;;AACA;AACA,uEAFA,CAGA;;AACAC;AACA;AACA;AACA;AACA,OAJA;AAKA;AAxEA;AAlEA","names":["name","components","CategoryMenu","NavBar","CategoryContent","TabControl","BackTop","Scroll","GoodsList","mixins","data","categories","categoryData","scroll","isTabFixed","currentIndex","currentType","saveY","tabOffsetTop","computed","showSubcategory","created","mounted","activated","deactivated","methods","_tabClick","index","selectItem","console","contentScroll","position","_getCategory","getCategory","subcategories","categoryDetail","_getSubCategories","getSubcategory","_getCategoryDetail","type","getCategoryDetail"],"sourceRoot":"src/views/category","sources":["Category.vue"],"sourcesContent":["<template>\n  <div class=\"category\">\n    <!--    导航-->\n    <nav-bar class=\"nav-bar\">\n      <div slot=\"center\">商品分类</div>\n    </nav-bar>\n\n    <tab-control :title=\"['综合', '新品', '销量']\"\n                 @tabClick=\"tabClick\"\n                 ref=\"tabControl1\"\n                 class=\"tab-control2\"\n                 v-show=\"isTabFixed\">\n    </tab-control>\n\n    <div class=\"content\">\n      <category-menu :categories=\"categories\"\n                     @selectItem=\"selectItem\">\n      </category-menu>\n\n      <scroll id=\"tab-content\"\n              :data=\"[categoryData]\"\n              :probe-type=\"3\"\n              @scroll=\"contentScroll\"\n              ref=\"scroll\">\n        <div>\n\n          <category-content :subcategories=\"showSubcategory\">\n\n          </category-content>\n          <img :src=\"showSubcategory.image\" alt=\"\">\n\n<!--          <tab-control :title=\"['综合','新品','销量']\"-->\n<!--                       @tabClick=\"tabClick\"-->\n<!--                       ref=\"tabControl2\">-->\n<!--          </tab-control>-->\n\n          <goods-list ></goods-list>\n        </div>\n      </scroll>\n    </div>\n\n    <back-top v-show=\"isShowBackTop\" @click.native=\"backClick\"></back-top>\n  </div>\n</template>\n\n<script>\n  import CategoryMenu from \"./CategoryMenu\";\n  import CategoryContent from \"./CategoryContent\";\n\n  import NavBar from \"../../components/common/navbar/NavBar\";\n  import BackTop from \"../../components/content/backTop/BackTop\";\n\n  import TabControl from \"../../components/content/tabControl\";\n  import Scroll from \"../../components/common/scroll/Scroll\";\n  import GoodsList from \"../../components/content/goods/goodsList\";\n\n  import {POP, NEW, SELL, TOP_DISTANCE} from \"../../common/const\";\n  import {getCategory, getSubcategory, getCategoryDetail} from \"../../network/category\";\n  import {itemListener, backTopMinxin, tabControlMixin} from \"../../common/mixin\";\n\n  export default {\n    name: \"Category\",\n    components: {\n      CategoryMenu,\n      NavBar,\n      CategoryContent,\n      TabControl,\n      BackTop,\n      Scroll,\n      GoodsList\n    },\n    mixins: [itemListener, backTopMinxin, tabControlMixin],\n    data(){\n      return {\n        categories: [],\n        categoryData: {},\n        scroll: null,\n        isTabFixed: false,\n        currentIndex: -1,\n        currentType: POP,\n        saveY: 0,\n        tabOffsetTop: 0\n      }\n    },\n    computed: {\n\n      showSubcategory() {\n        if(this.currentIndex === -1) {\n          return {}\n        }\n        return this.categoryData[this.currentIndex].subcategories;\n      },\n      // showCategoryDetail() {\n      //   if(this.currentIndex === -1) {\n      //     return [];\n      //   }\n      //   return this.categoryDetail[this.currentIndex].categoryDetail[this.currentType];\n      // }\n    },\n    created() {\n      //请求分类数据\n      this._getCategory();\n\n    },\n    mounted() {\n      this.$bus.$on('gridViewImgLoad', () => {\n        //refresh重新计算better-scroll,   this.$refs.scroll：组件创建完成才能执行后面函数\n        this.$refs.scroll.scroll.refresh();\n        this.tabOffsetTop = this.$refs.tabControl2.$el.offsetTop;\n        this.tabOffsetLeft = this.$refs.scroll.$el.offsetLeft;\n      })\n    },\n    activated() {\n      //一进入组件就滚动到离开时保存的位置\n      this.$refs.scroll&& this.$refs.scroll.scrollTo(0, this.saveY, 10);\n      //refresh\n      this.$refs.scroll&& this.$refs.scroll.scroll.refresh();\n    },\n    deactivated() {\n      //保存离开时的位置\n      this.saveY = this.$refs.scroll.scroll.y;\n\n      // 2、取消全局事件监听\n      this.$bus.$off('itemImgLoad', this.itemImgListener);\n\n    },\n    methods: {\n      /**\n       * 事件相应相关方法\n       */\n      //tabControl的点击，mixin里的tabClick发生点击事件并调用此方法\n      _tabClick(index) {\n        this.$refs.tabControl1.currentIndex = index;\n        this.$refs.tabControl2.currentIndex = index;\n      },\n      //监听点击了那个分类栏目\n      selectItem(index) {\n        this._getSubCategories(index);\n        console.log(index)\n      },\n      //监听滚动的位置（使用scroll组件传过来的事件）\n      contentScroll(position) {\n        //监听BackTop是否显示\n        this.isShowBackTop = position.y < TOP_DISTANCE;\n\n        //判断tabControl是否需要吸顶\n        this.isTabFixed = this.tabOffsetTop <= (-position.y);\n      },\n      /**\n       * 网络请求额相关法\n       */\n      //1、拿到分类数据\n      _getCategory() {\n        getCategory().then(res => {\n          console.log(res.data);\n          //保存分类数据\n          this.categories = res.data.category.list;\n          // console.log(this.categories);\n          //初始化每个类别的子数据\n          for(let i = 0; i < this.categories.length; i++) {\n            this.categoryData[i] = {\n              subcategories: {},\n              categoryDetail: {\n                'pop': [],\n                'new': [],\n                'sell': []\n              }\n            }\n          }\n          //请求第一个分类的数据\n          this._getSubCategories(0);\n        })\n      },\n      //根据分类栏的下标去请求相应的数据\n      _getSubCategories(index) {\n        this.currentIndex = index;\n        const mailKey = this.categories[index].maitKey;\n        // console.log(mailKey);\n        getSubcategory(mailKey).then(res => {\n          console.log(res.data);\n          this.categoryData[index].subcategories = res.data;\n\n          this.categoryData = {...this.categoryData};\n          // this._getCategoryDetail(POP)\n          // this._getCategoryDetail(SELL)\n          // this._getCategoryDetail(NEW)\n        })\n      },\n      //3、根据类型请求相应的商品数据（pop,new,sell）\n      _getCategoryDetail(type) {\n        //获取请求的minWallkey\n        const miniWallkey = this.categories[this.currentIndex].miniWallkey;\n        //发送请求,传入miniWallkey和type\n        getCategoryDetail(miniWallkey,type).then(res => {\n          //将获取的数据保存下来\n          this.categoryData[this.currentIndex].categoryDetail[type] = res;\n          this.categoryData = {...this.categoryData};\n        })\n      }\n    }\n  }\n</script>\n\n<style scoped>\n  .category {\n    height: 100%;\n  }\n\n  .nav-bar {\n    position: relative;\n    background-color: var(--color-tint);\n    color: #fff;\n    font-weight: 700;\n    z-index: 3;\n  }\n\n  .content {\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 44px;\n    bottom: 49px;\n    display: flex;\n  }\n\n  #tab-content {\n    overflow: hidden;\n    height: calc(100vh - 49px - 44px);\n    flex: 1;\n  }\n\n  .tab-control2 {\n    position: absolute;\n    width: calc(100% - 101px);\n    z-index: 3;\n    right: 0;\n  }\n</style>\n"]}]}