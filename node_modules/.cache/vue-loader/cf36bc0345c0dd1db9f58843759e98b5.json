{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_vue-loader@15.9.8@vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\src\\views\\detail\\Detail.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\src\\views\\detail\\Detail.vue","mtime":1649235352969},{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_babel-loader@8.2.4@babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_vue-loader@15.9.8@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport DetailNavBar from \"./DetailNavBar\"\nimport DetailSwiper from \"./DetailSwiper\"\nimport DetailBaseInfo from \"./DetailBaseInfo\"\nimport DetailShopInfo from \"./DetailShopInfo\"\nimport DetailGoodsInfo from \"./DetailGoodsInfo\"\nimport DetailParamsInfo from \"./DetailParamsInfo\"\nimport DetailCommentInfo from \"./DetailCommentInfo\";\nimport DetailBottomBar from \"./DetailBottomBar\";\n\nimport Scroll from \"../../components/common/scroll/Scroll\";\nimport GoodsList from \"../../components/content/goods/goodsList\";\nimport BackTop from \"../../components/content/backTop/BackTop\";\nimport Toast from \"../../components/common/toast/Toast\";\n\nimport {getDetail, getRecommend, Goods, GoodsParam, Shop} from \"../../network/detail\";\nimport {debounce} from \"../../common/utils\";\nimport {itemListener, backTopMinxin} from \"../../common/mixin\";\n\nimport {mapActions} from 'vuex';\n\nexport default {\n    name: \"Detail\",\n    data() {\n        return {\n            iid: null,\n            topImages: [],\n            goods: {},\n            shop: {},\n            detailInfo: {},\n            paramInfo: {},\n            commentInfo: {},\n            recommends: [],\n\n            themeTopYs: [],\n            getThemeTopY: null,\n            currentIndex: 0,\n            isShowBackTop: true,\n            message: '',\n            show: false\n        }\n    },\n    mixins: [itemListener, backTopMinxin],\n    components: {\n        DetailNavBar,\n        DetailSwiper,\n        DetailBaseInfo,\n        DetailShopInfo,\n        DetailGoodsInfo,\n        DetailParamsInfo,\n        DetailCommentInfo,\n        DetailBottomBar,\n        Scroll,\n        GoodsList,\n        BackTop,\n        Toast\n    },\n    created() {\n        //1保存传入的iid\n        this.iid = this.$route.params.iid;\n        //2根据iid请求详情数据\n        getDetail(this.iid).then(res => {\n            const data = res.result;\n            //获取顶部轮播图数据\n            this.topImages = data.itemInfo.topImages;\n            //获取商品信息\n            this.goods = new Goods(data.itemInfo, data.columns, data.shopInfo.services);\n            //获取店铺信息\n            this.shop = new Shop(data.shopInfo);\n            //    获取商品 详细信息\n            this.detailInfo = data.detailInfo;\n            //    保存参数信息\n            this.paramInfo = new GoodsParam(data.itemParams.info, data.itemParams.rule);\n            //    取出评论信息\n            if (data.rate.CRate !== 0) {\n                this.commentInfo = data.rate.list[0]\n            }\n\n        })\n        //3、请求推荐数据\n        getRecommend().then(res => {\n            console.log(res);\n            this.recommends = res.data.list;\n        });\n\n        //4、给getthemeTopY赋值(进行防抖）\n        this.getThemeTopY = debounce(() => {\n            this.themeTopYs = [];\n            this.themeTopYs.push(0);\n            this.themeTopYs.push(this.$refs.params.$el.offsetTop);\n            this.themeTopYs.push(this.$refs.comment.$el.offsetTop);\n            this.themeTopYs.push(this.$refs.recommend.$el.offsetTop);\n\n            console.log(this.themeTopYs);\n        }, 500);\n\n    },\n    methods: {\n        // 点击箭头回滚到顶部\n        backClick() {\n            this.$refs.scroll.scrollTo(0, 0)\n        },\n        //可以使用对象方式 'add':'addCart'\n        ...mapActions(['addCart']),\n        imageLoad() {\n            console.log('-----');\n            this.$refs.scroll.scroll.refresh();\n            // this.refresh();\n            this.getThemeTopY();\n        },\n        //点击导航栏scroll滑动到相应位置\n        titleClick(index) {\n            console.log(index);\n            this.$refs.scroll.scrollTo(0, -this.themeTopYs[index] + 44, 200);\n        },\n        //scroll滑动\n        contentScroll(position) {\n            // console.log(position);\n            const positionY = -position.y + 44;\n\n            //2、positionY与主题中的值进行对比\n            // [0, 13780, 15063, 15279,]\n            //positonY在0-13780之间 index = 0\n            //......\n            //positonY在15279之后 index = 3\n            for (let i = 0; i < this.themeTopYs.length; i++) {\n                //console.log(i); //str 下面 i+ 1会有问题\n                // if(positionY > this.themeTopYs[i] && positionY < this.themeTopYs[i + 1]) {\n                //\n                // }\n                let length = this.themeTopYs.length;\n                if (this.currentIndex !== i\n                    && ((i < length - 1 && positionY >= this.themeTopYs[i]\n                        && positionY < this.themeTopYs[i + 1])\n                        || (i === length - 1 && positionY >= this.themeTopYs[i]))) {\n                    //对于上面一长串的范围判断使用this.themeTopYs.push(Number.MAX.VALUE);\n                    //这样可以省去 || 之后的判断代码\n                    this.currentIndex = i;\n                    console.log(this.currentIndex);\n                    this.$refs.nav.currentIndex = this.currentIndex;\n                }\n            }\n\n            //是否显示回到顶部\n            this.isShowBackTop = (-position.y) > 1000;\n        },\n        //添加到购物车\n        addToCart(){\n            // console.log('addToCart');\n            //1、获取购物车需要展示的信息加入购物车\n            const product = {};\n            product.image = this.topImages[0];\n            product.title = this.goods.title;\n            product.desc = this.goods.desc;\n            product.price = this.goods.newPrice;\n            product.iid = this.iid;\n            product.realPrice = this.goods.realPrice;\n\n            //2、将商品添加购物车里面\n            // this.$store.commit('addCart', product);\n\n            // this.$store.dispatch('addCart', product).then(res => {\n            //   console.log(res);\n            // });\n\n            //将上面 的方法影射到本组件内部(利用mapActions\n            this.addCart(product).then(res => {\n                console.log(res);\n                this.show = true;\n                this.message = res;\n\n                setTimeout(() => {\n                  this.show = false;\n                  this.message = '';\n                }, 1500);\n                // console.log(this.$toast);\n                // this.$toast.show(res,2000);\n            })\n        }\n    }\n\n\n}\n",{"version":3,"sources":["Detail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAwBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA","file":"Detail.vue","sourceRoot":"src/views/detail","sourcesContent":["<template>\r\n    <div id=\"detail\">\r\n\r\n        <DetailNavBar @titleClick=\"titleClick\" class=\"detail-nav\" ref=\"nav\"></DetailNavBar>\r\n        <scroll :probe-type=\"3\" @scroll=\"contentScroll\" class=\"content\" ref=\"scroll\">\r\n            <DetailSwiper :topImages=\"topImages\"></DetailSwiper>\r\n            <DetailBaseInfo :goods=\"goods\"></DetailBaseInfo>\r\n            <DetailShopInfo :shop=\"shop\"></DetailShopInfo>\r\n            <DetailGoodsInfo :detailInfo=\"detailInfo\" @imageLoad=\"imageLoad\"></DetailGoodsInfo>\r\n            <DetailParamsInfo :paramInfo=\"paramInfo\" ref=\"params\"></DetailParamsInfo>\r\n            <DetailCommentInfo :commentInfo=\"commentInfo\" ref=\"comment\"></DetailCommentInfo>\r\n            <GoodsList :goods=\"recommends\" ref=\"recommend\"></GoodsList>\r\n        </scroll>\r\n        <!--底部导航栏-->\r\n        <DetailBottomBar @addCart=\"addToCart\"></DetailBottomBar>\r\n        <!-- 底部小火煎-->\r\n        <BackTop @click.native=\"backClick\" v-show=\"isShowBackTop\"></BackTop>\r\n        <!--toast组件封装成插件进行显示-->\r\n        <toast :message=\"message\" :is-show=\"show\"></toast>\r\n    </div>\r\n\r\n</template>\r\n\r\n<script>\r\n    import DetailNavBar from \"./DetailNavBar\"\r\n    import DetailSwiper from \"./DetailSwiper\"\r\n    import DetailBaseInfo from \"./DetailBaseInfo\"\r\n    import DetailShopInfo from \"./DetailShopInfo\"\r\n    import DetailGoodsInfo from \"./DetailGoodsInfo\"\r\n    import DetailParamsInfo from \"./DetailParamsInfo\"\r\n    import DetailCommentInfo from \"./DetailCommentInfo\";\r\n    import DetailBottomBar from \"./DetailBottomBar\";\r\n\r\n    import Scroll from \"../../components/common/scroll/Scroll\";\r\n    import GoodsList from \"../../components/content/goods/goodsList\";\r\n    import BackTop from \"../../components/content/backTop/BackTop\";\r\n    import Toast from \"../../components/common/toast/Toast\";\r\n\r\n    import {getDetail, getRecommend, Goods, GoodsParam, Shop} from \"../../network/detail\";\r\n    import {debounce} from \"../../common/utils\";\r\n    import {itemListener, backTopMinxin} from \"../../common/mixin\";\r\n\r\n    import {mapActions} from 'vuex';\r\n\r\n    export default {\r\n        name: \"Detail\",\r\n        data() {\r\n            return {\r\n                iid: null,\r\n                topImages: [],\r\n                goods: {},\r\n                shop: {},\r\n                detailInfo: {},\r\n                paramInfo: {},\r\n                commentInfo: {},\r\n                recommends: [],\r\n\r\n                themeTopYs: [],\r\n                getThemeTopY: null,\r\n                currentIndex: 0,\r\n                isShowBackTop: true,\r\n                message: '',\r\n                show: false\r\n            }\r\n        },\r\n        mixins: [itemListener, backTopMinxin],\r\n        components: {\r\n            DetailNavBar,\r\n            DetailSwiper,\r\n            DetailBaseInfo,\r\n            DetailShopInfo,\r\n            DetailGoodsInfo,\r\n            DetailParamsInfo,\r\n            DetailCommentInfo,\r\n            DetailBottomBar,\r\n            Scroll,\r\n            GoodsList,\r\n            BackTop,\r\n            Toast\r\n        },\r\n        created() {\r\n            //1保存传入的iid\r\n            this.iid = this.$route.params.iid;\r\n            //2根据iid请求详情数据\r\n            getDetail(this.iid).then(res => {\r\n                const data = res.result;\r\n                //获取顶部轮播图数据\r\n                this.topImages = data.itemInfo.topImages;\r\n                //获取商品信息\r\n                this.goods = new Goods(data.itemInfo, data.columns, data.shopInfo.services);\r\n                //获取店铺信息\r\n                this.shop = new Shop(data.shopInfo);\r\n                //    获取商品 详细信息\r\n                this.detailInfo = data.detailInfo;\r\n                //    保存参数信息\r\n                this.paramInfo = new GoodsParam(data.itemParams.info, data.itemParams.rule);\r\n                //    取出评论信息\r\n                if (data.rate.CRate !== 0) {\r\n                    this.commentInfo = data.rate.list[0]\r\n                }\r\n\r\n            })\r\n            //3、请求推荐数据\r\n            getRecommend().then(res => {\r\n                console.log(res);\r\n                this.recommends = res.data.list;\r\n            });\r\n\r\n            //4、给getthemeTopY赋值(进行防抖）\r\n            this.getThemeTopY = debounce(() => {\r\n                this.themeTopYs = [];\r\n                this.themeTopYs.push(0);\r\n                this.themeTopYs.push(this.$refs.params.$el.offsetTop);\r\n                this.themeTopYs.push(this.$refs.comment.$el.offsetTop);\r\n                this.themeTopYs.push(this.$refs.recommend.$el.offsetTop);\r\n\r\n                console.log(this.themeTopYs);\r\n            }, 500);\r\n\r\n        },\r\n        methods: {\r\n            // 点击箭头回滚到顶部\r\n            backClick() {\r\n                this.$refs.scroll.scrollTo(0, 0)\r\n            },\r\n            //可以使用对象方式 'add':'addCart'\r\n            ...mapActions(['addCart']),\r\n            imageLoad() {\r\n                console.log('-----');\r\n                this.$refs.scroll.scroll.refresh();\r\n                // this.refresh();\r\n                this.getThemeTopY();\r\n            },\r\n            //点击导航栏scroll滑动到相应位置\r\n            titleClick(index) {\r\n                console.log(index);\r\n                this.$refs.scroll.scrollTo(0, -this.themeTopYs[index] + 44, 200);\r\n            },\r\n            //scroll滑动\r\n            contentScroll(position) {\r\n                // console.log(position);\r\n                const positionY = -position.y + 44;\r\n\r\n                //2、positionY与主题中的值进行对比\r\n                // [0, 13780, 15063, 15279,]\r\n                //positonY在0-13780之间 index = 0\r\n                //......\r\n                //positonY在15279之后 index = 3\r\n                for (let i = 0; i < this.themeTopYs.length; i++) {\r\n                    //console.log(i); //str 下面 i+ 1会有问题\r\n                    // if(positionY > this.themeTopYs[i] && positionY < this.themeTopYs[i + 1]) {\r\n                    //\r\n                    // }\r\n                    let length = this.themeTopYs.length;\r\n                    if (this.currentIndex !== i\r\n                        && ((i < length - 1 && positionY >= this.themeTopYs[i]\r\n                            && positionY < this.themeTopYs[i + 1])\r\n                            || (i === length - 1 && positionY >= this.themeTopYs[i]))) {\r\n                        //对于上面一长串的范围判断使用this.themeTopYs.push(Number.MAX.VALUE);\r\n                        //这样可以省去 || 之后的判断代码\r\n                        this.currentIndex = i;\r\n                        console.log(this.currentIndex);\r\n                        this.$refs.nav.currentIndex = this.currentIndex;\r\n                    }\r\n                }\r\n\r\n                //是否显示回到顶部\r\n                this.isShowBackTop = (-position.y) > 1000;\r\n            },\r\n            //添加到购物车\r\n            addToCart(){\r\n                // console.log('addToCart');\r\n                //1、获取购物车需要展示的信息加入购物车\r\n                const product = {};\r\n                product.image = this.topImages[0];\r\n                product.title = this.goods.title;\r\n                product.desc = this.goods.desc;\r\n                product.price = this.goods.newPrice;\r\n                product.iid = this.iid;\r\n                product.realPrice = this.goods.realPrice;\r\n\r\n                //2、将商品添加购物车里面\r\n                // this.$store.commit('addCart', product);\r\n\r\n                // this.$store.dispatch('addCart', product).then(res => {\r\n                //   console.log(res);\r\n                // });\r\n\r\n                //将上面 的方法影射到本组件内部(利用mapActions\r\n                this.addCart(product).then(res => {\r\n                    console.log(res);\r\n                    this.show = true;\r\n                    this.message = res;\r\n\r\n                    setTimeout(() => {\r\n                      this.show = false;\r\n                      this.message = '';\r\n                    }, 1500);\r\n                    // console.log(this.$toast);\r\n                    // this.$toast.show(res,2000);\r\n                })\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    #detail {\r\n        position: relative;\r\n        z-index: 9;\r\n        background-color: #fff;\r\n        height: 100vh;\r\n    }\r\n\r\n    .detail-nav {\r\n        position: relative;\r\n        z-index: 9;\r\n        background-color: #fff;\r\n    }\r\n\r\n    .content {\r\n        background-color: #fff;\r\n        height: calc(100% - 44px - 49px);\r\n    }\r\n\r\n    /*.content {*/\r\n    /*    background-color: #fff;*/\r\n    /*    height: calc(100% - 44px - 49px);*/\r\n    /*}*/\r\n</style>\r\n"]}]}