{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_vue-loader@15.9.8@vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\src\\views\\category\\Category.vue?vue&type=style&index=0&id=1a0c5ce5&scoped=true&lang=css&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\src\\views\\category\\Category.vue","mtime":1649234414681},{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_css-loader@1.0.1@css-loader\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_vue-loader@15.9.8@vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_postcss-loader@3.0.0@postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\SuperMarket\\supermarket\\node_modules\\_vue-loader@15.9.8@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.category {\n  height: 100%;\n}\n\n.nav-bar {\n  position: relative;\n  background-color: var(--color-tint);\n  color: #fff;\n  font-weight: 700;\n  z-index: 3;\n}\n\n.content {\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 44px;\n  bottom: 49px;\n  display: flex;\n}\n\n#tab-content {\n  overflow: hidden;\n  height: calc(100vh - 49px - 44px);\n  flex: 1;\n}\n\n.tab-control2 {\n  position: absolute;\n  width: calc(100% - 101px);\n  z-index: 3;\n  right: 0;\n}\n",{"version":3,"sources":["Category.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4MA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"Category.vue","sourceRoot":"src/views/category","sourcesContent":["<template>\n  <div class=\"category\">\n    <!--    导航-->\n    <nav-bar class=\"nav-bar\">\n      <div slot=\"center\">商品分类</div>\n    </nav-bar>\n\n    <tab-control :title=\"['综合', '新品', '销量']\"\n                 @tabClick=\"tabClick\"\n                 ref=\"tabControl1\"\n                 class=\"tab-control2\"\n                 v-show=\"isTabFixed\">\n    </tab-control>\n\n    <div class=\"content\">\n      <category-menu :categories=\"categories\"\n                     @selectItem=\"selectItem\">\n      </category-menu>\n\n      <scroll id=\"tab-content\"\n              :data=\"[categoryData]\"\n              :probe-type=\"3\"\n              @scroll=\"contentScroll\"\n              ref=\"scroll\">\n        <div>\n\n          <category-content :subcategories=\"showSubcategory\">\n\n          </category-content>\n          <img :src=\"showSubcategory.image\" alt=\"\">\n\n<!--          <tab-control :title=\"['综合','新品','销量']\"-->\n<!--                       @tabClick=\"tabClick\"-->\n<!--                       ref=\"tabControl2\">-->\n<!--          </tab-control>-->\n\n          <goods-list ></goods-list>\n        </div>\n      </scroll>\n    </div>\n\n    <back-top v-show=\"isShowBackTop\" @click.native=\"backClick\"></back-top>\n  </div>\n</template>\n\n<script>\n  import CategoryMenu from \"./CategoryMenu\";\n  import CategoryContent from \"./CategoryContent\";\n\n  import NavBar from \"../../components/common/navbar/NavBar\";\n  import BackTop from \"../../components/content/backTop/BackTop\";\n\n  import TabControl from \"../../components/content/tabControl\";\n  import Scroll from \"../../components/common/scroll/Scroll\";\n  import GoodsList from \"../../components/content/goods/goodsList\";\n\n  import {POP, NEW, SELL, TOP_DISTANCE} from \"../../common/const\";\n  import {getCategory, getSubcategory, getCategoryDetail} from \"../../network/category\";\n  import {itemListener, backTopMinxin, tabControlMixin} from \"../../common/mixin\";\n\n  export default {\n    name: \"Category\",\n    components: {\n      CategoryMenu,\n      NavBar,\n      CategoryContent,\n      TabControl,\n      BackTop,\n      Scroll,\n      GoodsList\n    },\n    mixins: [itemListener, backTopMinxin, tabControlMixin],\n    data(){\n      return {\n        categories: [],\n        categoryData: {},\n        scroll: null,\n        isTabFixed: false,\n        currentIndex: -1,\n        currentType: POP,\n        saveY: 0,\n        tabOffsetTop: 0\n      }\n    },\n    computed: {\n\n      showSubcategory() {\n        if(this.currentIndex === -1) {\n          return {}\n        }\n        return this.categoryData[this.currentIndex].subcategories;\n      },\n      // showCategoryDetail() {\n      //   if(this.currentIndex === -1) {\n      //     return [];\n      //   }\n      //   return this.categoryDetail[this.currentIndex].categoryDetail[this.currentType];\n      // }\n    },\n    created() {\n      //请求分类数据\n      this._getCategory();\n\n    },\n    mounted() {\n      this.$bus.$on('gridViewImgLoad', () => {\n        //refresh重新计算better-scroll,   this.$refs.scroll：组件创建完成才能执行后面函数\n        this.$refs.scroll.scroll.refresh();\n        this.tabOffsetTop = this.$refs.tabControl2.$el.offsetTop;\n        this.tabOffsetLeft = this.$refs.scroll.$el.offsetLeft;\n      })\n    },\n    activated() {\n      //一进入组件就滚动到离开时保存的位置\n      this.$refs.scroll&& this.$refs.scroll.scrollTo(0, this.saveY, 10);\n      //refresh\n      this.$refs.scroll&& this.$refs.scroll.scroll.refresh();\n    },\n    deactivated() {\n      //保存离开时的位置\n      this.saveY = this.$refs.scroll.scroll.y;\n\n      // 2、取消全局事件监听\n      this.$bus.$off('itemImgLoad', this.itemImgListener);\n\n    },\n    methods: {\n      /**\n       * 事件相应相关方法\n       */\n      //tabControl的点击，mixin里的tabClick发生点击事件并调用此方法\n      _tabClick(index) {\n        this.$refs.tabControl1.currentIndex = index;\n        this.$refs.tabControl2.currentIndex = index;\n      },\n      //监听点击了那个分类栏目\n      selectItem(index) {\n        this._getSubCategories(index);\n        console.log(index)\n      },\n      //监听滚动的位置（使用scroll组件传过来的事件）\n      contentScroll(position) {\n        //监听BackTop是否显示\n        this.isShowBackTop = position.y < TOP_DISTANCE;\n\n        //判断tabControl是否需要吸顶\n        this.isTabFixed = this.tabOffsetTop <= (-position.y);\n      },\n      /**\n       * 网络请求额相关法\n       */\n      //1、拿到分类数据\n      _getCategory() {\n        getCategory().then(res => {\n          console.log(res.data);\n          //保存分类数据\n          this.categories = res.data.category.list;\n          // console.log(this.categories);\n          //初始化每个类别的子数据\n          for(let i = 0; i < this.categories.length; i++) {\n            this.categoryData[i] = {\n              subcategories: {},\n              categoryDetail: {\n                'pop': [],\n                'new': [],\n                'sell': []\n              }\n            }\n          }\n          //请求第一个分类的数据\n          this._getSubCategories(0);\n        })\n      },\n      //根据分类栏的下标去请求相应的数据\n      _getSubCategories(index) {\n        this.currentIndex = index;\n        const mailKey = this.categories[index].maitKey;\n        // console.log(mailKey);\n        getSubcategory(mailKey).then(res => {\n          console.log(res.data);\n          this.categoryData[index].subcategories = res.data;\n\n          this.categoryData = {...this.categoryData};\n          // this._getCategoryDetail(POP)\n          // this._getCategoryDetail(SELL)\n          // this._getCategoryDetail(NEW)\n        })\n      },\n      //3、根据类型请求相应的商品数据（pop,new,sell）\n      _getCategoryDetail(type) {\n        //获取请求的minWallkey\n        const miniWallkey = this.categories[this.currentIndex].miniWallkey;\n        //发送请求,传入miniWallkey和type\n        getCategoryDetail(miniWallkey,type).then(res => {\n          //将获取的数据保存下来\n          this.categoryData[this.currentIndex].categoryDetail[type] = res;\n          this.categoryData = {...this.categoryData};\n        })\n      }\n    }\n  }\n</script>\n\n<style scoped>\n  .category {\n    height: 100%;\n  }\n\n  .nav-bar {\n    position: relative;\n    background-color: var(--color-tint);\n    color: #fff;\n    font-weight: 700;\n    z-index: 3;\n  }\n\n  .content {\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 44px;\n    bottom: 49px;\n    display: flex;\n  }\n\n  #tab-content {\n    overflow: hidden;\n    height: calc(100vh - 49px - 44px);\n    flex: 1;\n  }\n\n  .tab-control2 {\n    position: absolute;\n    width: calc(100% - 101px);\n    z-index: 3;\n    right: 0;\n  }\n</style>\n"]}]}